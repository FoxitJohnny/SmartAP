{{- if .Values.backend.enabled -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "smartap.fullname" . }}-backend
  labels:
    {{- include "smartap.componentLabels" (dict "component" "backend" "root" .) | nindent 4 }}
spec:
  type: {{ .Values.backend.service.type }}
  ports:
  - port: {{ .Values.backend.service.port }}
    targetPort: http
    protocol: TCP
    name: http
  selector:
    {{- include "smartap.componentSelectorLabels" (dict "component" "backend" "root" .) | nindent 4 }}
{{- end }}
---
{{- if .Values.frontend.enabled -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "smartap.fullname" . }}-frontend
  labels:
    {{- include "smartap.componentLabels" (dict "component" "frontend" "root" .) | nindent 4 }}
spec:
  type: {{ .Values.frontend.service.type }}
  ports:
  - port: {{ .Values.frontend.service.port }}
    targetPort: http
    protocol: TCP
    name: http
  selector:
    {{- include "smartap.componentSelectorLabels" (dict "component" "frontend" "root" .) | nindent 4 }}
{{- end }}
---
{{- if .Values.nginx.enabled -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "smartap.fullname" . }}-nginx
  labels:
    {{- include "smartap.componentLabels" (dict "component" "nginx" "root" .) | nindent 4 }}
  {{- if eq .Values.nginx.service.type "LoadBalancer" }}
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: nlb
    service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"
  {{- end }}
spec:
  type: {{ .Values.nginx.service.type }}
  ports:
  - port: {{ .Values.nginx.service.port }}
    targetPort: http
    protocol: TCP
    name: http
  {{- if .Values.nginx.service.httpsPort }}
  - port: {{ .Values.nginx.service.httpsPort }}
    targetPort: https
    protocol: TCP
    name: https
  {{- end }}
  selector:
    {{- include "smartap.componentSelectorLabels" (dict "component" "nginx" "root" .) | nindent 4 }}
{{- end }}
---
{{- if .Values.postgresql.enabled -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "smartap.fullname" . }}-postgresql
  labels:
    {{- include "smartap.componentLabels" (dict "component" "postgresql" "root" .) | nindent 4 }}
spec:
  type: {{ .Values.postgresql.service.type }}
  clusterIP: None
  ports:
  - port: {{ .Values.postgresql.service.port }}
    targetPort: postgresql
    protocol: TCP
    name: postgresql
  selector:
    {{- include "smartap.componentSelectorLabels" (dict "component" "postgresql" "root" .) | nindent 4 }}
{{- end }}
---
{{- if .Values.redis.enabled -}}
apiVersion: v1
kind: Service
metadata:
  name: {{ include "smartap.fullname" . }}-redis
  labels:
    {{- include "smartap.componentLabels" (dict "component" "redis" "root" .) | nindent 4 }}
spec:
  type: {{ .Values.redis.service.type }}
  clusterIP: None
  ports:
  - port: {{ .Values.redis.service.port }}
    targetPort: redis
    protocol: TCP
    name: redis
  selector:
    {{- include "smartap.componentSelectorLabels" (dict "component" "redis" "root" .) | nindent 4 }}
{{- end }}
