# SmartAP Environment Configuration
# Copy this file to .env and fill in your values

# ================================
# DATABASE CONFIGURATION
# ================================

# PostgreSQL Database
DB_HOST=db
DB_PORT=5432
DB_NAME=smartap
DB_USER=smartap
DB_PASSWORD=change_this_secure_password  # ⚠️ CHANGE IN PRODUCTION

# Database URL (auto-constructed from above, or provide directly)
# DATABASE_URL=postgresql+asyncpg://smartap:password@db:5432/smartap

# For production, use connection pooling:
# DB_POOL_SIZE=20
# DB_MAX_OVERFLOW=10

# ================================
# REDIS CONFIGURATION
# ================================

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=  # Leave blank for no password (dev) or set password (production)
REDIS_DB=0

# Redis URL (auto-constructed from above, or provide directly)
# REDIS_URL=redis://redis:6379/0

# ================================
# BACKEND API CONFIGURATION
# ================================

# Application
APP_NAME=SmartAP
APP_VERSION=1.0.0
APP_ENV=development  # Options: development, staging, production

# Security
SECRET_KEY=change_this_to_a_very_long_random_string  # ⚠️ GENERATE: openssl rand -hex 32
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# CORS (Comma-separated origins)
CORS_ORIGINS=http://localhost:3000,http://localhost:8000

# Server
HOST=0.0.0.0
PORT=8000
DEBUG=true  # ⚠️ Set to false in production
LOG_LEVEL=info  # Options: debug, info, warning, error, critical

# ================================
# AI MODEL CONFIGURATION
# ================================

# AI Provider Selection
# Options: github, azure, openai, anthropic
AI_PROVIDER=github

# --- GitHub Models (Free tier, good for testing) ---
# Get token: https://github.com/settings/tokens
GITHUB_TOKEN=your_github_personal_access_token
GITHUB_MODEL=gpt-4o  # Options: gpt-4o, gpt-4-turbo, gpt-3.5-turbo
GITHUB_API_BASE=https://models.inference.ai.azure.com

# --- Azure OpenAI (Recommended for production) ---
# AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com
# AZURE_OPENAI_API_KEY=your_azure_openai_api_key
# AZURE_OPENAI_DEPLOYMENT=gpt-4  # Your deployment name
# AZURE_OPENAI_API_VERSION=2024-02-15-preview

# --- OpenAI (Direct API) ---
# OPENAI_API_KEY=your_openai_api_key
# OPENAI_MODEL=gpt-4-turbo  # Options: gpt-4-turbo, gpt-4, gpt-3.5-turbo
# OPENAI_ORGANIZATION=your_org_id  # Optional

# --- Anthropic Claude ---
# ANTHROPIC_API_KEY=your_anthropic_api_key
# ANTHROPIC_MODEL=claude-3-opus-20240229  # Options: opus, sonnet, haiku

# AI Model Settings
MAX_TOKENS=4000  # Maximum tokens for AI responses
TEMPERATURE=0.1  # Lower = more deterministic (0.0-2.0)
TIMEOUT=60  # Request timeout in seconds

# ================================
# FOXIT SDK CONFIGURATION
# ================================

# Foxit PDF SDK (for OCR)
FOXIT_LICENSE_KEY=your_foxit_license_key
FOXIT_LICENSE_SN=your_foxit_serial_number

# Foxit eSign (for digital signatures)
FOXIT_ESIGN_API_KEY=your_foxit_esign_api_key
FOXIT_ESIGN_API_SECRET=your_foxit_esign_api_secret
FOXIT_ESIGN_API_URL=https://api.foxitesign.com/v1

# ================================
# ERP INTEGRATION
# ================================

# --- QuickBooks ---
QUICKBOOKS_CLIENT_ID=your_quickbooks_client_id
QUICKBOOKS_CLIENT_SECRET=your_quickbooks_client_secret
QUICKBOOKS_REDIRECT_URI=http://localhost:8000/api/erp/quickbooks/callback
QUICKBOOKS_ENVIRONMENT=sandbox  # Options: sandbox, production
# After OAuth flow, these will be set:
# QUICKBOOKS_REALM_ID=your_realm_id
# QUICKBOOKS_ACCESS_TOKEN=your_access_token
# QUICKBOOKS_REFRESH_TOKEN=your_refresh_token

# --- Xero ---
XERO_CLIENT_ID=your_xero_client_id
XERO_CLIENT_SECRET=your_xero_client_secret
XERO_REDIRECT_URI=http://localhost:8000/api/erp/xero/callback
XERO_SCOPES=accounting.transactions,accounting.contacts
# After OAuth flow, these will be set:
# XERO_TENANT_ID=your_tenant_id
# XERO_ACCESS_TOKEN=your_access_token
# XERO_REFRESH_TOKEN=your_refresh_token

# --- SAP ---
SAP_API_URL=https://your-sap-instance.com/api
SAP_USERNAME=your_sap_username
SAP_PASSWORD=your_sap_password
SAP_CLIENT=100  # SAP client number
SAP_COMPANY_DB=your_company_database

# --- NetSuite ---
NETSUITE_ACCOUNT_ID=your_account_id
NETSUITE_CONSUMER_KEY=your_consumer_key
NETSUITE_CONSUMER_SECRET=your_consumer_secret
NETSUITE_TOKEN_ID=your_token_id
NETSUITE_TOKEN_SECRET=your_token_secret

# ================================
# APPROVAL WORKFLOW
# ================================

# Approval Thresholds (in USD)
AUTO_APPROVE_THRESHOLD=1000.00  # Invoices below this are auto-approved
REVIEW_REQUIRED_THRESHOLD=10000.00  # Invoices above this require additional review
EXECUTIVE_APPROVAL_THRESHOLD=50000.00  # Invoices above this require executive approval

# Approval Rules
APPROVAL_TIMEOUT_HOURS=48  # Hours before approval times out
ENABLE_PARALLEL_APPROVALS=false  # Allow multiple approvers at same level
REQUIRE_PO_MATCH=true  # Require PO match for approval

# ================================
# EMAIL CONFIGURATION
# ================================

# SMTP Settings
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_app_specific_password  # For Gmail: https://myaccount.google.com/apppasswords
SMTP_USE_TLS=true
SMTP_USE_SSL=false

# Email Settings
EMAIL_FROM=noreply@smartap.com
EMAIL_FROM_NAME=SmartAP Automation
NOTIFICATION_EMAIL=approvers@company.com  # Comma-separated for multiple recipients

# Email Templates
EMAIL_TEMPLATE_DIR=./backend/templates/emails

# ================================
# FILE STORAGE
# ================================

# Upload Settings
UPLOAD_DIR=./data/uploads
PROCESSED_DIR=./data/processed
ARCHIVAL_DIR=./data/archival
SIGNED_DIR=./data/signed

MAX_UPLOAD_SIZE=10485760  # 10MB in bytes
ALLOWED_EXTENSIONS=pdf,png,jpg,jpeg,tiff

# Cloud Storage (Optional)
# CLOUD_STORAGE_PROVIDER=azure  # Options: azure, aws, gcp
# AZURE_STORAGE_CONNECTION_STRING=your_connection_string
# AZURE_STORAGE_CONTAINER=smartap-invoices
# AWS_ACCESS_KEY_ID=your_access_key
# AWS_SECRET_ACCESS_KEY=your_secret_key
# AWS_S3_BUCKET=smartap-invoices
# AWS_REGION=us-east-1

# ================================
# ARCHIVAL & RETENTION
# ================================

# Retention Policies (in days)
INVOICE_RETENTION_DAYS=2555  # 7 years (SOX compliance)
AUDIT_LOG_RETENTION_DAYS=2555  # 7 years
TEMP_FILE_RETENTION_DAYS=7  # Temporary files cleanup

# Archival Settings
ENABLE_AUTO_ARCHIVAL=true
ARCHIVAL_SCHEDULE=0 2 * * *  # Cron format: Daily at 2 AM
COMPRESS_ARCHIVED_FILES=true

# ================================
# CELERY (Background Tasks)
# ================================

# Celery Configuration
CELERY_BROKER_URL=redis://redis:6379/1
CELERY_RESULT_BACKEND=redis://redis:6379/1
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json
CELERY_ACCEPT_CONTENT=json
CELERY_TIMEZONE=UTC
CELERY_ENABLE_UTC=true

# Task Settings
CELERY_TASK_SOFT_TIME_LIMIT=300  # 5 minutes
CELERY_TASK_TIME_LIMIT=600  # 10 minutes
CELERY_TASK_TRACK_STARTED=true
CELERY_TASK_ACKS_LATE=true

# Worker Settings
CELERY_WORKER_CONCURRENCY=4  # Number of concurrent workers
CELERY_WORKER_PREFETCH_MULTIPLIER=1
CELERY_WORKER_MAX_TASKS_PER_CHILD=1000  # Restart worker after N tasks

# ================================
# MONITORING & LOGGING
# ================================

# Logging
LOG_FORMAT=json  # Options: json, text
LOG_FILE=./logs/smartap.log
LOG_ROTATION=daily  # Options: daily, weekly, size
LOG_RETENTION_DAYS=30

# Sentry (Error Tracking)
# SENTRY_DSN=your_sentry_dsn
# SENTRY_ENVIRONMENT=production
# SENTRY_TRACES_SAMPLE_RATE=0.1

# Application Insights (Azure)
# APPINSIGHTS_INSTRUMENTATION_KEY=your_instrumentation_key

# Prometheus Metrics
ENABLE_METRICS=true
METRICS_PORT=9090

# ================================
# SECURITY
# ================================

# JWT Settings
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# Password Requirements
MIN_PASSWORD_LENGTH=8
REQUIRE_PASSWORD_COMPLEXITY=true  # Uppercase, lowercase, digit, special char

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_BURST=10

# Security Headers
ENABLE_HSTS=true
ENABLE_CSP=true

# ================================
# FEATURE FLAGS
# ================================

# Enable/Disable Features
ENABLE_FRAUD_DETECTION=true
ENABLE_PO_MATCHING=true
ENABLE_AUTO_APPROVAL=true
ENABLE_DIGITAL_SIGNATURES=true
ENABLE_ERP_SYNC=true
ENABLE_EMAIL_NOTIFICATIONS=true

# Experimental Features (use with caution)
ENABLE_EXPERIMENTAL_AI_MODELS=false
ENABLE_BETA_FEATURES=false

# ================================
# FRONTEND CONFIGURATION
# ================================

# Frontend Build Variables (for docker-compose)
REACT_APP_API_URL=http://localhost:8000
REACT_APP_APP_NAME=SmartAP
REACT_APP_VERSION=1.0.0

# ================================
# DEVELOPMENT SETTINGS
# ================================

# Development Mode
DEV_MODE=true  # ⚠️ Set to false in production
RELOAD_ON_CHANGE=true  # Auto-reload on code changes
SHOW_SQL_QUERIES=false  # Log all SQL queries (verbose)

# Test Database (for running tests)
TEST_DATABASE_URL=sqlite+aiosqlite:///./test.db

# Seed Data
CREATE_SAMPLE_DATA_ON_STARTUP=false  # Auto-create sample invoices/POs

# ================================
# DOCKER SETTINGS
# ================================

# Postgres Container
POSTGRES_PASSWORD=smartap_dev_password  # Must match DB_PASSWORD

# Compose Settings
COMPOSE_PROJECT_NAME=smartap

# ================================
# CUSTOM AGENT CONFIGURATION
# ================================

# Carbon Footprint Agent
CARBON_API_KEY=your_carbon_api_key
CARBON_API_URL=https://api.carbon.example.com

# Currency Conversion Agent
EXCHANGE_RATE_API_KEY=your_exchange_rate_api_key
EXCHANGE_RATE_API_URL=https://api.exchangerate.host
TARGET_CURRENCY=USD

# Fraud Detection Agent
FRAUD_DETECTION_THRESHOLD=60  # Risk score threshold (0-100)
ENABLE_DUPLICATE_CHECK=true
ENABLE_VENDOR_VALIDATION=true

# ================================
# NOTES
# ================================

# 1. Generate SECRET_KEY: openssl rand -hex 32
# 2. For Gmail SMTP: Use app-specific password (https://myaccount.google.com/apppasswords)
# 3. For production: Change all default passwords and keys
# 4. For AI providers: Start with GitHub Models (free), then scale to Azure OpenAI
# 5. For ERP integration: Complete OAuth flows to get access/refresh tokens
# 6. For file storage: Use local storage for dev, cloud storage for production
# 7. For monitoring: Enable Sentry or Application Insights in production
# 8. For security: Enable HTTPS in production with valid SSL certificates
